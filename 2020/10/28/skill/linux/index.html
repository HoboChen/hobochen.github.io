<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.0.0-rc1">
  <link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico">
  <link rel="mask-icon" href="/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"192217.space","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"right","width":280,"display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Linux all in ONE.">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux Memo">
<meta property="og:url" content="https://192217.space/2020/10/28/skill/linux/index.html">
<meta property="og:site_name" content="Hobo Chen&#39;s Blog">
<meta property="og:description" content="Linux all in ONE.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2020-10-28T21:56:17.000Z">
<meta property="article:modified_time" content="2023-04-02T22:20:21.354Z">
<meta property="article:author" content="Hobo Chen">
<meta property="article:tag" content="short">
<meta property="article:tag" content="practice">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://192217.space/2020/10/28/skill/linux/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Linux Memo | Hobo Chen's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hobo Chen's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-notebook">

    <a href="/note" rel="section"><i class="fa fa-sticky-note fa-fw"></i>Notes</a>

  </li>
        <li class="menu-item menu-item-slide">

    <a href="/slide" rel="section"><i class="fa fa-desktop fa-fw"></i>Slides</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://192217.space/2020/10/28/skill/linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.png">
      <meta itemprop="name" content="Hobo Chen">
      <meta itemprop="description" content="50% Humanities 50% Science">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hobo Chen's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Linux Memo
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-10-28 14:56:17" itemprop="dateCreated datePublished" datetime="2020-10-28T14:56:17-07:00">2020-10-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-04-02 15:20:21" itemprop="dateModified" datetime="2023-04-02T15:20:21-07:00">2023-04-02</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Linux all in ONE.</p>
<span id="more"></span>
<h1 id="bootstrap-ubuntu">Bootstrap Ubuntu</h1>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt upgrade -y</span><br><span class="line"></span><br><span class="line">sudo apt install sysstat htop iftop wget tmux curl zsh ripgrep \</span><br><span class="line">  lm-sensors \</span><br><span class="line">  vim git build-essential python3</span><br><span class="line">sudo apt install gnome-tweak-tool net-tools</span><br><span class="line">sudo apt install openjdk-17-jdk clang ghc</span><br><span class="line"><span class="comment"># sudo apt install texlive-full</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># to store local time in bios, to resolve compatibility issue when dual boot windows</span></span><br><span class="line">timedatectl set-local-rtc 1 </span><br><span class="line"></span><br><span class="line"><span class="comment"># nvm</span></span><br><span class="line">curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.3/install.sh | bash</span><br><span class="line"><span class="comment"># oh-my-zsh</span></span><br><span class="line">sh -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)</span>&quot;</span></span><br><span class="line"><span class="comment"># pip</span></span><br><span class="line">python3 -m pip install --user --upgrade pip</span><br><span class="line"></span><br><span class="line"><span class="comment"># close and re-open</span></span><br><span class="line">nvm install --lts</span><br><span class="line">npm install tldr</span><br></pre></td></tr></table></figure>
<h1 id="system-tune">System Tune</h1>
<h2 id="tune-max-open-files">Tune Max Open Files</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 系统</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;fs.file-max = 65535&#x27;</span> | sudo <span class="built_in">tee</span> -a /etc/sysctl.conf</span><br><span class="line">sudo sysctl -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户</span></span><br><span class="line">sudo <span class="built_in">tee</span> -a /etc/security/limits.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">*               hard    nofile          65535</span></span><br><span class="line"><span class="string">*               soft    nofile          65535</span></span><br><span class="line"><span class="string">root            hard    nofile          65535</span></span><br><span class="line"><span class="string">root            soft    nofile          65535</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Systemd</span></span><br><span class="line">sudo sed -i <span class="string">&#x27;/DefaultLimitNOFILE/c DefaultLimitNOFILE=65535&#x27;</span> /etc/systemd/*.conf</span><br><span class="line">sudo systemctl daemon-reexec</span><br></pre></td></tr></table></figure>
<h2 id="hd-idle"><code>hd-idle</code></h2>
<p><a href="https://github.com/adelolmo/hd-idle">Github Page</a>.</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># /etc/default/hd-idle</span></span><br><span class="line"></span><br><span class="line"><span class="attr">START_HD_IDLE</span>=<span class="literal">true</span></span><br><span class="line"><span class="attr">HD_IDLE_OPTS</span>=<span class="string">&quot;-i 120 -d -l /var/log/hd-idle.log&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="add-swap-and-mount">Add Swap and Mount</h2>
<p>Add Swap:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo fallocate -l 2G /swapfile</span><br><span class="line">sudo <span class="built_in">chmod</span> 600 /swapfile</span><br><span class="line">sudo mkswap /swapfile</span><br><span class="line">sudo swapon /swapfile</span><br></pre></td></tr></table></figure>
<p>Check if works:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">free -h</span><br></pre></td></tr></table></figure>
<h1 id="system-maintainance-manual">System Maintainance Manual</h1>
<h2 id="add-new-disk">Add New Disk</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk -l</span><br></pre></td></tr></table></figure>
<p>to partition:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo fdisk /dev/sdb</span><br></pre></td></tr></table></figure>
<p>Then type: <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">g <span class="comment"># create a new GPT disk lable</span></span><br><span class="line">n <span class="comment"># new partition, i only add one partition is this disk, </span></span><br><span class="line">  <span class="comment"># so i press enter for two times then</span></span><br><span class="line">w <span class="comment"># write the changes</span></span><br></pre></td></tr></table></figure></p>
<p>format:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mkfs -t ext4 /dev/sdb1 <span class="comment"># use ext4 file system</span></span><br></pre></td></tr></table></figure>
<p>mount:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> ~/flush</span><br><span class="line">sudo mount /dev/sdb1 ~/flush</span><br></pre></td></tr></table></figure>
<p>Then check the new disk.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>
<p>auto mount:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/fstab</span><br></pre></td></tr></table></figure>
<p>Add this line in the end of file. <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/sdb1	/home/hobochen/flush ext4 defaults 0 0</span><br></pre></td></tr></table></figure></p>
<h2 id="zfs-related">ZFS related</h2>
<h3 id="install">install</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install zfsutils-linux</span><br></pre></td></tr></table></figure>
<h3 id="easy-mirror-rpool">Easy mirror rpool</h3>
<p>This section is copied from <a href="https://gist.github.com/yorickdowne/a2a330873b16ebf288d74e87d35bff3e">here</a>.</p>
<p>All the rights belong to the original auther. This is just a backup.</p>
<h4 id="overview">Overview</h4>
<p>Ubuntu Desktop 20.04 supports a single ZFS boot drive out of the box. I wanted a ZFS mirror, without going through an entirely manual setup of Ubuntu as described by <a href="https://openzfs.github.io/openzfs-docs/Getting%20Started/Ubuntu/Ubuntu%2020.04%20Root%20on%20ZFS.html">OpenZFS</a></p>
<p>This adds a mirror to an existing Ubuntu ZFS boot drive after the fact.</p>
<p>ZFS requires native encryption to be added at pool / dataset creation. Ubuntu 21.04 supports this during installation. Whether these instructions are suitable for mirroring such a setup has not been tested. For Ubuntu 20.04, these instructions are not suitable for creating an encrypted ZFS boot disk, please use the full instructions linked above for that. You can, however, add an encrypted dataset after the fact: You could encrypt just the portion of your file system that holds secrets.</p>
<p>Note: If your use case is running docker instances, and not a full-fledged Ubuntu install, then take a look at <a href="https://www.truenas.com/truenas-scale/">TrueNAS SCALE</a>, which will manage the ZFS parts for you.</p>
<p>It can also be worthwhile to boot from a regular ext4 disk, whether single or mirrored, and then use a ZFS mirror pool for just <code>/home</code> and <code>/var</code>. In that case these instructions aren't needed.</p>
<h4 id="why">Why</h4>
<p>ZFS has a few advantages that are good to have - It uses checksums, which means that hardware failure and disk corruption will be detected and flagged during regular "scrub" operations - It supports mirrors, which means that even with a failed drive, data is not lost - It is a Copy-on-Write file system, which means that snapshots are fast to create and fast to roll back to (seconds), and only take as much space as what was written after their creation. They can be created on a per-dataset basis. - It has the concept of datasets, making it easy to take snapshots of specific portions of the file system, as desired. <a href="https://briankoopman.com/zfs-automated-snapshots/">Automated ZFS snapshots</a> with a rotation lifetime make a lot of sense. - It can expand the size of a vdev by replacing first one, then the other drive with a larger one.</p>
<p>ZFS functions unlike traditional file systems such as ext4. Ars Technica has a good <a href="https://arstechnica.com/information-technology/2020/05/zfs-101-understanding-zfs-storage-and-performance/">introduction to ZFS</a>.</p>
<h4 id="how">How</h4>
<h5 id="assumptions-and-requirements">Assumptions and requirements</h5>
<ul>
<li>All drives will be formatted. These instructions are not suitable for dual-boot</li>
<li>No hardware or software RAID is to be used, these would keep ZFS from detecting disk errors and correcting them. In UEFI, set controller mode to AHCI, not RAID.</li>
<li>These instructions are specific to UEFI systems and GPT. If you have an older BIOS/MBR system, please use the full instructions linked above</li>
</ul>
<h5 id="initial-ubuntu-installation">Initial Ubuntu installation</h5>
<ul>
<li>Install from an Ubuntu Desktop 20.04 or later install USB. Ubuntu Server does not offer ZFS boot disk.</li>
<li>For the "Erase disk and install Ubuntu" option, click "Advanced Features" and choose "Experimental ZFS"</li>
<li>Continue install as normal and boot into Ubuntu</li>
</ul>
<h5 id="add-second-drive">Add second drive</h5>
<p>All work will be done from CLI. Open a Terminal. In the following, use copy &amp; paste extensively, it'll help avoid typos. Right-click in Terminal pastes.</p>
<ul>
<li>Update Ubuntu: <code>sudo apt update &amp;&amp; sudo apt dist-upgrade</code></li>
<li>Find the names of your two disks: <code>ls -l /dev/disk/by-id</code>. The first disk will have four partitions, the second none.</li>
<li>Let's set variables for those disk paths so we can refer to them in the following <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DISK1=/dev/disk/by-id/scsi-disk1</span><br><span class="line">DISK2=/dev/disk/by-id/scsi-disk2</span><br></pre></td></tr></table></figure></li>
<li>Install tools: <code>sudo apt install -y gdisk mdadm grub-efi-amd64</code></li>
</ul>
<h6 id="create-partitions-on-second-drive">Create partitions on second drive</h6>
<ul>
<li>List partitions: <code>sudo sgdisk -p $DISK1</code>, you expect to see four of them</li>
<li>Change swap partition type: <code>sudo sgdisk -t2:FD00 $DISK1</code></li>
<li>Copy partition table from disk 1 to disk 2: <code>sudo sgdisk -R$DISK2 $DISK1</code></li>
<li>Change GUID of second disk: <code>sudo sgdisk -G $DISK2</code></li>
</ul>
<blockquote>
<p>Ubuntu 21.04 required a reboot at this point in my testing, so that <code>/dev/disk/by-partuuid</code> was correct.If you need to do that, recreate <code>DISK1</code> and <code>DISK2</code> after the reboot.</p>
</blockquote>
<h6 id="mirror-boot-pool">Mirror boot pool</h6>
<ul>
<li>Confirm that disk 1 partition 3 is the device in the <strong>bpool</strong> by comparing "Partition unique GUID" to the device id shown in zpool status: <code>sudo sgdisk -i3 $DISK1</code> and <code>zpool status bpool</code></li>
<li>Get GUID of partition 3 on disk 2: <code>sudo sgdisk -i3 $DISK2</code></li>
<li>Add that partition to the pool: <code>sudo zpool attach bpool EXISTING-UID /dev/disk/by-partuuid/DISK2-PART3-GUID</code>, for example <code>sudo zpool attach bpool ac78ee0c-2d8d-3641-97dc-eb8b50abd492 /dev/disk/by-partuuid/8e1830b3-4e59-459c-9c02-a09c80428052</code></li>
<li>Verify with <code>zpool status bpool</code>. You expect to see mirror-0 now, which has been resilvered</li>
</ul>
<h6 id="mirror-root-pool">Mirror root pool</h6>
<ul>
<li>Confirm that disk 1 partition 4 is the device in the <strong>rpool</strong> by comparing "Partition unique GUID" to the device id shown in zpool status: <code>sudo sgdisk -i4 $DISK1</code> and <code>zpool status rpool</code></li>
<li>Get GUID of partition 4 on disk 2: <code>sudo sgdisk -i4 $DISK2</code></li>
<li>Add that partition to the pool: <code>sudo zpool attach rpool EXISTING-UID /dev/disk/by-partuuid/DISK2-PART4-GUID</code>, for example <code>sudo zpool attach rpool d9844f27-a1f8-3049-9831-77b51318d9a7 /dev/disk/by-partuuid/d9844f27-a1f8-3049-9831-77b51318d9a7</code></li>
<li>Verify with <code>zpool status rpool</code>. You expect to see mirror-0 now, which either is resilvering or has been resilvered</li>
</ul>
<h6 id="mirror-swap">Mirror swap</h6>
<ul>
<li>Remove existing swap: <code>sudo swapoff -a</code></li>
<li>Remove the swap mount line in /etc/fstab: <code>sudo nano /etc/fstab</code>, find the swap line at the end of the file and delete it, then save with Ctrl-x</li>
<li>Create software mirror drive for swap: <code>sudo mdadm --create /dev/md0 --metadata=1.2 --level=mirror --raid-devices=2 $&#123;DISK1&#125;-part2 $&#123;DISK2&#125;-part2</code></li>
<li>Configure it for swap: <code>sudo mkswap -f /dev/md0</code></li>
<li>Place it into fstab: <code>sudo sh -c "echo UUID=$(sudo blkid -s UUID -o value /dev/md0) none swap discard 0 0 &gt;&gt; /etc/fstab"</code></li>
<li>Verify that line is in fstab: <code>cat /etc/fstab</code></li>
<li>Use the new swap: <code>sudo swapon -a</code></li>
<li>And verify: <code>swapon -s</code></li>
</ul>
<h6 id="move-grub-boot-menu-to-zfs">Move GRUB boot menu to ZFS</h6>
<ul>
<li>Verify grub can "see" the ZFS boot pool: <code>sudo grub-probe /boot</code></li>
<li>Create EFI file system on second disk: <code>sudo mkdosfs -F 32 -s 1 -n EFI $&#123;DISK2&#125;-part1</code></li>
<li>Remove /boot/grub from fstab: <code>sudo nano /etc/fstab</code>, find the line for /boot/grub and remove it. Leave the line for /boot/efi in place. Save with Ctrl-x.</li>
<li>Unmount /boot/grub: <code>sudo umount /boot/grub</code></li>
<li>Verify with <code>df -h</code>, <code>/boot</code> should be mounted on <code>bpool/BOOT/ubuntu_UID</code>, <code>/boot/efi</code> on <code>/dev/sda1</code> or similar depending on device name of your first disk, and no <code>/boot/grub</code></li>
<li>Remove /boot/grub: <code>sudo rm -rf /boot/grub</code></li>
<li>And create a ZFS dataset for it: <code>sudo zfs create -o com.ubuntu.zsys:bootfs=no bpool/grub</code></li>
<li>Refresh initrd files: <code>sudo update-initramfs -c -k all</code></li>
<li>Disable memory zeroing to address a performance regression of ZFS on Linux: <code>sudo nano /etc/default/grub</code> and add <code>init_on_alloc=0</code> to <code>GRUB_CMDLINE_LINUX_DEFAULT</code>, it'll likely look like this: <code>GRUB_CMDLINE_LINUX_DEFAULT="quiet splash init_on_alloc=0"</code>. Save with Ctrl-x</li>
<li>Update the boot config: <code>sudo update-grub</code> and ignore any errors you may see from osprober</li>
<li>Install GRUB to the ESP: <code>sudo grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=ubuntu --recheck --no-floppy</code></li>
<li>Disable grub-initrd-fallback.service: <code>sudo systemctl mask grub-initrd-fallback.service</code>. This is the service for /boot/grub/grubenv which does not work on mirrored or raidz topologies. Disabling this keeps it from blocking subsequent mounts of /boot/grub if that mount ever fails.</li>
</ul>
<h6 id="reboot-and-install-grub-to-second-disk">Reboot and install GRUB to second disk</h6>
<ul>
<li>Cross fingers and reboot! <code>sudo reboot</code></li>
<li>Once back up, open a Terminal again and install GRUB to second disk: <code>sudo dpkg-reconfigure grub-efi-amd64</code> , keep defaults and when it comes to system partitions, use space bar to select first partition on both drives, e.g. /dev/sda1 and /dev/sdb1</li>
<li>And for good measure signed efi: <code>sudo dpkg-reconfigure grub-efi-amd64-signed</code> , this should finish without prompting you</li>
<li>If you like, you can remove the primary drive and reboot. You expect reboot to take a little longer, and to be successful. <code>zpool status</code> should show degraded pools without error</li>
</ul>
<h5 id="replacing-a-failed-drive">Replacing a failed drive</h5>
<p>If a mirrored drive fails, you can replace it by following a similar method as adding a second drive in the first place.</p>
<p>First, find the id of the replacement drive with <code>ls -l /dev/disk/by-id</code> and create a variable for it: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NEWDISK=/dev/disk/by-id/NEWDRIVEID</span><br></pre></td></tr></table></figure></p>
<p>The new drive may already contain ZFS or mdadm signatures. Check using <code>sudo wipefs $NEWDISK</code>. If that output is not empty, run <code>sudo wipefs -a $NEWDISK</code>.</p>
<h6 id="create-partition-table-on-replacement-disk">Create partition table on replacement disk</h6>
<ul>
<li>Copy partition table from existing disk to replacement disk: <code>sudo sgdisk -R$NEWDISK /dev/disk/by-id/ID-OF-EXISTING-DRIVE</code></li>
<li>Change GUID of replacement disk: <code>sudo sgdisk -G $NEWDISK</code></li>
</ul>
<h6 id="repair-boot-pool">Repair boot pool</h6>
<ul>
<li>Get the ID of the "UNAVAIL" disk on <strong>bpool</strong> with <code>zpool status bpool</code></li>
<li>Get GUID of partition 3 on the replacement disk: <code>sudo sgdisk -i3 $NEWDISK</code></li>
<li>Replace the failed member with that partition: <code>sudo zpool replace bpool EXISTING-UID /dev/disk/by-partuuid/NEWDISK-PART4-GUID</code>, for example <code>sudo zpool replace bpool 6681469899058372901 /dev/disk/by-partuuid/06f5ef6d-cb69-45e8-ad3b-c69cad5c216a</code></li>
<li>Verify with <code>zpool status bpool</code>. You expect to see state "ONLINE" for the pool and both devices in mirror-0.</li>
</ul>
<h6 id="repair-root-pool">Repair root pool</h6>
<ul>
<li>Get the ID of the "UNAVAIL" disk on <strong>rpool</strong> with <code>zpool status rpool</code></li>
<li>Get GUID of partition 4 on the replacement disk: <code>sudo sgdisk -i4 $NEWDISK</code></li>
<li>Replace the failed member with that partition: <code>sudo zpool replace rpool EXISTING-UID /dev/disk/by-partuuid/NEWDISK-PART4-GUID</code>, for example <code>sudo zpool replace rpool 8712274632631823759 /dev/disk/by-partuuid/8c4ec74f-cd4d-4048-bfca-b4a58756563d</code></li>
<li>Verify with <code>zpool status rpool</code>. You expect to see state "ONLINE" for the pool and both devices in mirror-0, or state "DEGRADED" for the pool with "resilver in progress" and a "replacing-0" entry under "mirror-0"</li>
</ul>
<h6 id="repair-swap">Repair swap</h6>
<ul>
<li>Verify that the failed disk shows as "removed": <code>sudo mdadm -D /dev/md0</code></li>
<li>Add partition 2 of the replacement disk: <code>sudo mdadm /dev/md0 --add $&#123;NEWDISK&#125;-part2</code></li>
<li>And verify that you can see "spare rebuilding" or "active sync": <code>sudo mdadm -D /dev/md0</code></li>
</ul>
<h6 id="repair-efi">Repair EFI</h6>
<ul>
<li>Create EFI file system on replacement disk: <code>sudo mkdosfs -F 32 -s 1 -n EFI $&#123;NEWDISK&#125;-part1</code></li>
<li>Install GRUB to replacement disk: <code>sudo dpkg-reconfigure grub-efi-amd64</code> , keep defaults and when it comes to system partitions, use space bar to select first partition on both drives, e.g. /dev/sda1 and /dev/sdb1</li>
<li>And for good measure signed efi: <code>sudo dpkg-reconfigure grub-efi-amd64-signed</code> , this should finish without prompting you</li>
</ul>
<h6 id="test">Test</h6>
<p>If you like, test by rebooting: <code>sudo reboot</code>, and confirm that pools are healthy after reboot with <code>zpool status</code></p>
<h5 id="increasing-drive-space">Increasing drive space</h5>
<p>Similar to replacing a failed drive, just that partition 4, the rpool partition, will be bigger. Wait for resilver after replacement, then replace the second drive. Once both drives have been replaced, rpool has the new capacity.</p>
<p>First, find the id of the replacement drive with <code>ls -l /dev/disk/by-id</code> and create a variable for it: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NEWDISK=/dev/disk/by-id/NEWDRIVEID</span><br></pre></td></tr></table></figure></p>
<p>The new drive may already contain ZFS or mdadm signatures. Check using <code>sudo wipefs $NEWDISK</code>. If that output is not empty, run <code>sudo wipefs -a $NEWDISK</code>.</p>
<h6 id="create-partition-table-on-replacement-disk-1">Create partition table on replacement disk</h6>
<ul>
<li>Copy partition table from existing disk to replacement disk: <code>sudo sgdisk -R$NEWDISK /dev/disk/by-id/ID-OF-EXISTING-DRIVE</code></li>
<li>Change GUID of replacement disk: <code>sudo sgdisk -G $NEWDISK</code></li>
<li>Remove partition 4: <code>sudo sgdisk -d4 $NEWDISK</code></li>
<li>Recreate partition 4 with maximum size: <code>sudo sgdisk -n4:0:0 -t4:BF00 $NEWDISK</code></li>
<li>Tell the kernel to use the new partition table: <code>sudo partprobe</code></li>
<li>Tell ZFS to use expanded space automatically: <code>sudo zpool set autoexpand=on rpool</code></li>
</ul>
<h6 id="repair-boot-pool-root-pool-swap-and-efi">Repair boot pool, root pool, swap and EFI</h6>
<p>Follow the instructions under "Replacing a failed drive", starting from "Repair boot pool". <strong>Wait for resilver to complete afterwards.</strong> Then, run through these instructions again, replacing the second drive. Once resilver is done a second time, you will have the new capacity on the <code>rpool</code>.</p>
<h4 id="alternate-idea">Alternate idea</h4>
<p>The <a href="https://zfsbootmenu.org/">ZFS Boot Menu</a> project aims to provide a cleaner, FreeBSD-ish boot experience complete with boot environments and full support for native ZFS encryption. <a href="https://github.com/zbm-dev/zfsbootmenu/wiki/Debian-Buster-installation-with-ESP-on-the-zpool-disk">Community instructions for Debian</a> exist and could be adapted to Ubuntu by way of blending them with the <a href="https://openzfs.github.io/openzfs-docs/Getting%20Started/Ubuntu/Ubuntu%2020.04%20Root%20on%20ZFS.html">OpenZFS Ubuntu instructions</a>.</p>
<p>If you get that up and running on Ubuntu, please share the instructions!</p>
<h4 id="youtube">Youtube</h4>
<p>I did a <a href="https://www.youtube.com/watch?v=uwq47T_22p8">walkthrough</a> of these instructions.</p>
<h3 id="maintain">maintain</h3>
<p>keep latest 4 snapshots</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs list -t snapshot -o name -S creation -r bpool | grep autozsys | <span class="built_in">tail</span> -n +16 | xargs -n 1 <span class="built_in">echo</span> sudo zfs destroy -vr</span><br></pre></td></tr></table></figure>
<p>check free space with snapshots</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfs list -o space -r bpool</span><br></pre></td></tr></table></figure>
<h1 id="installing-software-manual">Installing Software Manual</h1>
<h2 id="install-glog">Install <code>glog</code></h2>
<p>I want to install Google Log(C++) in my Ubuntu, but I met the problem: <code>/usr/bin/ld: //usr/local/lib/libgflags.a(gflags.cc.o): relocation R_X86_64_32 against .rodata.str1.1' can not be used when making a shared object; recompile with -fPIC</code>.</p>
<p>The cause is that the <code>gflags</code> is not compiled as shared libraries when installing. Here is a solution.</p>
<p>Jump to gflags directory, and run <code>ccmake .</code>. Change the <code>BUILD_SHARED_LIBS</code> to <code>ON</code>.</p>
<p>If you found that <code>ccmake</code> is not found.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install cmake-curses-gui </span><br></pre></td></tr></table></figure>
<p>Then, jump back to <code>glog</code> directory, run:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make -j`<span class="built_in">nproc</span>` &amp;&amp; sudo make install</span><br></pre></td></tr></table></figure>
<h2 id="gitlab">Gitlab</h2>
<h3 id="install-1">install</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install -y curl openssh-server ca-certificates</span><br><span class="line">curl -sS https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh | sudo bash</span><br><span class="line">sudo apt install gitlab-ce</span><br></pre></td></tr></table></figure>
<p>Conf file is: <code>/etc/gitlab/gitlab.rb</code>。</p>
<p>If machine has a real FQDN:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">external_url <span class="string">&#x27;http://gitlab-hz.192217.space&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="memory-tune">memory tune</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">puma[<span class="string">&#x27;per_worker_max_memory_mb&#x27;</span>] = <span class="number">512</span></span><br><span class="line">puma[<span class="string">&#x27;worker_processes&#x27;</span>] = <span class="number">4</span></span><br><span class="line">sidekiq[<span class="string">&#x27;concurrency&#x27;</span>] = <span class="number">16</span></span><br><span class="line">prometheus[<span class="string">&#x27;enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">postgresql[<span class="string">&#x27;shared_buffers&#x27;</span>] = <span class="string">&quot;512MB&quot;</span> <span class="comment"># **recommend value is 1/4 of total RAM, up to 14GB.**</span></span><br></pre></td></tr></table></figure>
<h3 id="to-use-external-smtp-service">to use external smtp service</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_from&#x27;</span>] = <span class="string">&#x27;hobochen96@qq.com&#x27;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.qq.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;smtp.qq.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;say_you_love_me&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = <span class="number">465</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;hobochen96&quot;</span></span><br></pre></td></tr></table></figure>
<p><code>sudo gitlab-ctl reconfigure</code> to make changes effective.</p>
<h3 id="to-back-up">to back up</h3>
<p>meta:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/gitlab/gitlab-secrets.json</span><br><span class="line">/etc/gitlab/gitlab.rb</span><br></pre></td></tr></table></figure>
<p>data:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo gitlab-rake gitlab:backup:create</span><br></pre></td></tr></table></figure>
<h3 id="to-restore">to restore</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">sudo <span class="built_in">cp</span> _file /var/opt/gitlab/backups/</span><br><span class="line">sudo <span class="built_in">chown</span> git.git /var/opt/gitlab/backups/_file</span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl stop unicorn</span><br><span class="line">sudo gitlab-ctl stop sidekiq</span><br><span class="line"></span><br><span class="line"><span class="comment"># Verify</span></span><br><span class="line">sudo gitlab-ctl status</span><br><span class="line"></span><br><span class="line"><span class="comment"># This command will overwrite the contents of your GitLab database!</span></span><br><span class="line">sudo gitlab-rake gitlab:backup:restore BACKUP=1493107454_2018_04_25_10.6.4-ce</span><br><span class="line"></span><br><span class="line"><span class="comment"># Restore the meta</span></span><br><span class="line"></span><br><span class="line">sudo gitlab-ctl restart</span><br><span class="line">sudo gitlab-rake gitlab:check SANITIZE=<span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>Ref：</p>
<ol type="1">
<li>https://docs.gitlab.com/ee/raketasks/backup_restore.html</li>
</ol>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/short/" rel="tag"># short</a>
              <a href="/tags/practice/" rel="tag"># practice</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/25/misc/why-i-prefer-linux/" rel="prev" title="Why Do I Prefer Linux">
      <i class="fa fa-chevron-left"></i> Why Do I Prefer Linux
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/12/17/annual/2020/" rel="next" title="2020">
      2020 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#bootstrap-ubuntu"><span class="nav-text">Bootstrap Ubuntu</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#system-tune"><span class="nav-text">System Tune</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#tune-max-open-files"><span class="nav-text">Tune Max Open Files</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hd-idle"><span class="nav-text">hd-idle</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#add-swap-and-mount"><span class="nav-text">Add Swap and Mount</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#system-maintainance-manual"><span class="nav-text">System Maintainance Manual</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#add-new-disk"><span class="nav-text">Add New Disk</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zfs-related"><span class="nav-text">ZFS related</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#install"><span class="nav-text">install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#easy-mirror-rpool"><span class="nav-text">Easy mirror rpool</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#overview"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#why"><span class="nav-text">Why</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#how"><span class="nav-text">How</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#assumptions-and-requirements"><span class="nav-text">Assumptions and requirements</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#initial-ubuntu-installation"><span class="nav-text">Initial Ubuntu installation</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#add-second-drive"><span class="nav-text">Add second drive</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#create-partitions-on-second-drive"><span class="nav-text">Create partitions on second drive</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#mirror-boot-pool"><span class="nav-text">Mirror boot pool</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#mirror-root-pool"><span class="nav-text">Mirror root pool</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#mirror-swap"><span class="nav-text">Mirror swap</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#move-grub-boot-menu-to-zfs"><span class="nav-text">Move GRUB boot menu to ZFS</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#reboot-and-install-grub-to-second-disk"><span class="nav-text">Reboot and install GRUB to second disk</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#replacing-a-failed-drive"><span class="nav-text">Replacing a failed drive</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#create-partition-table-on-replacement-disk"><span class="nav-text">Create partition table on replacement disk</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#repair-boot-pool"><span class="nav-text">Repair boot pool</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#repair-root-pool"><span class="nav-text">Repair root pool</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#repair-swap"><span class="nav-text">Repair swap</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#repair-efi"><span class="nav-text">Repair EFI</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#test"><span class="nav-text">Test</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#increasing-drive-space"><span class="nav-text">Increasing drive space</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#create-partition-table-on-replacement-disk-1"><span class="nav-text">Create partition table on replacement disk</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#repair-boot-pool-root-pool-swap-and-efi"><span class="nav-text">Repair boot pool, root pool, swap and EFI</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#alternate-idea"><span class="nav-text">Alternate idea</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#youtube"><span class="nav-text">Youtube</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#maintain"><span class="nav-text">maintain</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#installing-software-manual"><span class="nav-text">Installing Software Manual</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#install-glog"><span class="nav-text">Install glog</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gitlab"><span class="nav-text">Gitlab</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#install-1"><span class="nav-text">install</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#memory-tune"><span class="nav-text">memory tune</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#to-use-external-smtp-service"><span class="nav-text">to use external smtp service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#to-back-up"><span class="nav-text">to back up</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#to-restore"><span class="nav-text">to restore</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hobo Chen"
      src="/uploads/avatar.png">
  <p class="site-author-name" itemprop="name">Hobo Chen</p>
  <div class="site-description" itemprop="description">50% Humanities 50% Science</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hobochen" title="GitHub → https://github.com/hobochen" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hobochen96@gmail.com" title="Email → mailto:hobochen96@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>Email</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2013 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hobo Chen</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
